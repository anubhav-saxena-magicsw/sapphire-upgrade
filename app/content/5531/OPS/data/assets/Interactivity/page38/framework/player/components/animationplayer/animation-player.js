define(["marionette","player/base/base-media-player","player/controllers/audio-controller"],function(t,i,e){var o=i.extend({initialize:function(t){var i=this;this._nCurrentFrame=1,this._nCurrentRow=1,this._nStartRow=1,this._nEndRow=1,this._idTimeOut=0,this._objParams=null,this._bLoop=!1,this._nTotalFrame=0,this._animationContainer=0,this._framePerSecond=12,this._width=0,this._height=0,this._startFrame=1,this._endFrame=0,this._spriteWidth=0,this._nInterval=0,this._nYpos=0,this._nMilPerSec=1e3,this._bReverse=!1,this._bAudioLoaded=!1,this._bAudioRequired=!1,this._bAnimationPlayingInitiated=!1,this._objAudioData={},this.initBaseMediaPlayer(this,this.PlayerConstants.ANIMATION_MEDIA_PLAYER),void 0!==t.fps&&(this._framePerSecond=parseInt(t.fps)),void 0!==t.playReverse&&(this._bReverse=t.playReverse),void 0!==t.audioFilePath?(this._bAudioRequired=!0,this._objAudioData.strPath=t.audioFilePath,this._objAudioData.bLoop=void 0!==t.audioLoop?t.audioLoop:!1,this._objAudioData.strTrack=this.cid,this._objAudioData.onStart=function(){i.onAudioStart()},this._objAudioData.onFinish=function(){i.onAudioFinish()}):this._bAudioRequired=!1,this._animationContainer=t.animationDiv,this._animationContainer=$(this._animationContainer),this._width=this._animationContainer.width(),this._height=this._animationContainer.height(),this._spriteWidth=t.spriteWidth,this._nTotalFrame=Math.round(this._spriteWidth/this._width),this._endFrame=this._nTotalFrame,("true"===this._bReverse||this._bReverse===!0)&&(this._bReverse=!0,this._endFrame=1,this._nCurrentFrame=this._nTotalFrame,this._startFrame=this._nTotalFrame),this._nInterval=Math.round(this._nMilPerSec/this._framePerSecond),$(this._animationContainer).on("click",$.proxy(i.compClick,i)),$(this._animationContainer).on("mouseover",$.proxy(i.compRollover,i)),$(this._animationContainer).on("mouseout",$.proxy(i.compRollout,i))},loadAudioFile:function(){e.getInstance().playAudio(this._objAudioData)},onAudioStart:function(){this._bAudioLoaded=!0,this.play()},onAudioFinish:function(){console.log("audio finish callback")},playAnimation:function(t){{var i,o;this.getStageScaleValue()}return o=!1,clearTimeout(t._idTimeOut),i=t._width*(t._nCurrentFrame-1),t._nCurrentRow>0&&(this._nYpos=(t._nCurrentRow-1)*this._height),i=String("-"+i+"px"+(" -"+this._nYpos+"px")),t.customEventDispatcher("animationProgress_",t,t._nCurrentFrame),t.trigger(t.ANIMATION_PROGRESS,t._nCurrentFrame),t._animationContainer.css("background-position",i),t._nCurrentFrame===t._endFrame&&(o=!0,t._nCurrentFrame=t._startFrame-1,t._nCurrentRow!==t._nEndRow&&(this._bReverse?t._nCurrentRow--:t._nCurrentRow++,o=!1)),o&&(t._nCurrentRow=t._nStartRow,t.customEventDispatcher("animationFinished_",t,t._nCurrentFrame),t.trigger(t.ANIMATION_FINISHED,t._nCurrentFrame),!t._bLoop)?(t._bAudioRequired&&e.getInstance().stopAudio(this._objAudioData.strTrack),clearTimeout(t._idTimeOut),void 0):(this._bReverse?t._nCurrentFrame--:t._nCurrentFrame++,t.playNextFrame(),void 0)},playNextFrame:function(){var t=this;t._idTimeOut=setTimeout(function(){t.playAnimation(t)},t._nInterval)},checkOptionsPropertyDetails:function(t){var i=!1;return t.animationDiv?void 0===t.spriteWidth&&(i=!0):i=!0,i},initAnimationPlayer:function(t,i){checkOptionsPropertyDetails(t)||(i._objParams=t,initializePlayerValue(t,i))}});return o.prototype.compClick=function(){this.customEventDispatcher("compClick",this)},o.prototype.compRollover=function(){this.customEventDispatcher("compRollover",this)},o.prototype.compRollout=function(){this.customEventDispatcher("compRollout",this)},o.prototype.ANIMATION_PROGRESS="animationProgress",o.prototype.ANIMATION_FINISHED="animationFinished",o.prototype.__super__=i,o.prototype.hide=function(){this._animationContainer&&$(this._animationContainer).hide()},o.prototype.show=function(){this._animationContainer&&$(this._animationContainer).show()},o.prototype.toggle=function(){this._animationContainer&&$(this._animationContainer).toggle()},o.prototype.play=function(t,i,e,o,n){if(i&&((i>this._nTotalFrame||this.startFrame<1)&&console.error("Start frame should not be less than 1 or greater than total frames..."),this._startFrame=i,this._nCurrentFrame=i),e&&((this._endFrame>this._nTotalFrame||this._endFrame<1)&&console.error("End frame should not be less than 1 or greater than total frames..."),this._endFrame=e),i&&e&&(this._bReverse=this._startFrame>this._endFrame?!0:!1),void 0!==o&&(this._nStartRow=o,this._nCurrentRow=o),void 0!==n&&(this._nEndRow=n),o&&n&&(this._nStartRow>this._nEndRow?(this._bReverse=!0,this._startFrame<this._endFrame&&(this._nCurrentFrame=this._endFrame,this._endFrame=this._startFrame,this._startFrame=this._nCurrentFrame)):(this._bReverse=!1,this._startFrame>this._endFrame&&(this._nCurrentFrame=this._endFrame,this._endFrame=this._startFrame,this._startFrame=this._nCurrentFrame))),void 0!==t&&(this._bLoop=t),this._bAudioRequired&&!this._bAudioLoaded)this._bAnimationPlayingInitiated=!0,this.loadAudioFile();else{if(this._bAudioRequired&&this._bAudioLoaded)return this.resume(),void 0;clearTimeout(this._idTimeOut),this.playNextFrame()}},o.prototype.pause=function(){clearTimeout(this._idTimeOut),this._bAudioRequired&&this._bAudioLoaded&&e.getInstance().pauseAudio(this._objAudioData.strTrack)},o.prototype.resume=function(){this.playAnimation(this),this._bAudioRequired&&this._bAudioLoaded&&e.getInstance().resumeAudio(this._objAudioData.strTrack)},o.prototype.stop=function(){clearTimeout(this._idTimeOut),this._bAudioRequired&&this._bAudioLoaded&&e.getInstance().stopAudio(this._objAudioData.strTrack),this._nCurrentFrame=1,this._bLoop=!1,this._startFrame=1,this._bReverse&&(this._nCurrentFrame=this._nTotalFrame,this._startFrame=1)},o.prototype.setFPS=function(t){this._nInterval=Math.round(this._nMilPerSec/t)},o.prototype.getCurrentFrame=function(){return this._nCurrentFrame},o.prototype.getCurrentRow=function(){return this._nCurrentRow},o.prototype.gotoAndStop=function(t,i){clearTimeout(this._idTimeOut),this._nCurrentFrame=t;var e=this._width*(this._nCurrentFrame-1);void 0!==i&&(this._nYpos=this._width*i),e=String("-"+e+"px"+(" -"+this._nYpos+"px")),this._animationContainer.css("background-position",e)},o.prototype.getTotalFrames=function(){return this._nTotalFrame},o.prototype.destroy=function(){return this.unregisterMedia(),clearTimeout(this._idTimeOut),this._bAudioRequired&&this._bAudioLoaded&&e.getInstance().stopAudio(this._objAudioData.strTrack,!0),this.__super__.prototype.destroy(!0)},o});