define(["marionette","components/table/model/custom-table-item-model","components/table/model/custom-table-model","components/table/model/custom-table-collection"],function(e,t,o,l){var a={CONST_TABLE_DATA:"tableData",CONST_ITEM_RENDERER:"itemRenderer",CONST_ITEM_CONTAINER:"tbody",CONST_SINGLE:"single",CONST_MULTIPLE:"multiple",doConfiguration:function(e,t){null===e.customTableCollection&&(e.customTableCollection=new l,e.collection=e.customTableCollection),null===e.customTableModel&&(e.customTableModel=new o,e.model=e.customTableModel),t&&(t.hasOwnProperty("className")&&e.customTableModel.set("className",t.className),t.hasOwnProperty("itemRendererClassName")&&(e.irClassName=t.itemRendererClassName),t.hasOwnProperty("selectionMode")&&(e.customTableModel.validate({selectionMode:t.selectionMode})||e.customTableModel.set("selectionMode",t.selectionMode)))},init:function(e,t){e.dataProvider=t.tableData,e.isDataProviderSet=!0,this.parseData(e,e.dataProvider)},changeDataProvider:function(e,t){t.hasOwnProperty(this.CONST_TABLE_DATA)||(t={tableData:t}),e.isDataProviderSet===!1?(this.init(e,t),e.hasItemRenderer||this.setItemRenderer(e),e.isDataProviderSet=!0,e.render()):(this.flush(e),this.init(e,t),e.isDataProviderSet=!0)},setItemRenderer:function(e,t){e.itemViewContainer=this.CONST_ITEM_CONTAINER,e.itemViewOptions={parentRef:e},e.itemView=t?t:this.getDefaultItemRenderer(e)},getDefaultItemRenderer:function(t){var o,l,a,r="";if(t.customTableCollection.models.length>0){l=t.customTableCollection.models[0];for(a in l.attributes)l.attributes.hasOwnProperty(a)&&"__"!==a.substring(0,2)&&"index"!==a&&(r+="<td>{{ "+a+" }}</td>")}return o=e.ItemView.extend({tagName:"tr",template:_.template(r)})},handleTablesTask:function(e){if(!e.hasOwnProperty("task"))throw new Error("### Table ### : No task has is defined");switch(e.task){case this.ADD_ROW:this.addRow();break;case this.DELETE_ROW:if(!e.hasOwnProperty("index"))throw new Error("No index defined!");this.deleteRow(e.index);break;case this.UPDATE_ROW:this.updateRow()}},addRow:function(e,t,o){var l=a.prepareItemModel(t);if(!t||void 0===t)throw new Error("Please provide row data to be added");if(o>e.customTableCollection.length||0>o)throw new Error("Index is out of bound!");void 0===o&&(o=e.customTableCollection.length),e.customTableCollection.addModelAt(l,o),this.resetRowSelection(e),e.trigger(e.ADD_ROW)},deleteRow:function(e,t){if(void 0===t)throw new Error("Please provide an index to delete a row!");e.customTableCollection.removeModelByIndex(t),this.resetRowSelection(e),e.trigger(e.DELETE_ROW)},updateRow:function(e,t,o){if(void 0===o)throw new Error("Please provide an index to update row data!");var l=e.customTableCollection.updateModelAt(t,o);e.children.findByModelCid(l.cid).render(),this.resetRowSelection(e),e.trigger(e.UPDATE_ROW)},resetRowSelection:function(e){var t=e.$(e.itemViewContainer+" tr[class $='"+e.clsPostfix+"']");t.removeClass(e.irClassName+e.clsPostfix).addClass(e.irClassName),e.customTableModel.resetSelectedIndices()},prepareItemModel:function(e){return new t(e)},parseData:function(e,o){var l;if(!o.headers.hasOwnProperty("header"))throw new Error("Please define at least one header to create table!");$.isArray(o.headers.header)===!1?e.customTableModel.set("headers",{header:[o.headers.header]}):e.customTableModel.set("headers",o.headers),e.customTableModel.set("selectedIndex",-1),e.customTableModel.set("selectedIndices",[]),o.rows.item.length?_.each(o.rows.item,function(o,a){l=new t(o),l.set("index",a),e.customTableCollection.add(l)}):(l=new t(o.rows.item),l.set("index",0),e.customTableCollection.add(l))},flush:function(e){e.isDataProviderSet=!1,e.children.call("destroy");var t;if(e.customTableCollection)for(;e.customTableCollection.first();)t=e.customTableCollection.first(),t.id=null,t.destroy(),t=null;e.customTableModel.destroy(),e.arrHookedEvent.length=0},destroy:function(e){var t;if(e.collection)for(;e.collection.first();)t=e.collection.first(),t.id=null,t.destroy(),t=null;e.model.id=e.customTableModel.id=null,e.customTableModel.destroy(),e.model.destroy(),e.model=e.customTableModel=null,e.collection=e.customTableCollection=null}};return a});