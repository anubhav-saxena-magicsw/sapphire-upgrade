define(["marionette","jqueryUI","jqueryTouchPunch","player/base/base-composite-comp","text!components/sectionnavigator/template/section-navigator-template.html","components/sectionnavigator/model/section-navigator-model","player/components/section-navigator/js/section-navigator-item","css!components/sectionnavigator/template/style/section-navigator.css"],function(t,e,i,o,s,n,c){var l=o.extend({template:_.template(s),itemView:c,itemViewContainer:"#sectionHotspotContainer",previousSelectedModel:null,initialize:function(t){var e,i,o,s,l,a,r=[],d={};for(this.model=new n,this.parseCompData(t,this.model),this.on(c.SECTION_HOTSPOT_CLICKED,this.onSectionHotSpotClicked),d=this.model.get("sectionData"),o=d.length,a=this.model.get("compLength")/o,this.itemViewOptions={context:this,itemWidth:a},l=Backbone.Model.extend({activities:[],defaults:{activities:[],sectionId:"",trackerClass:"",hotspotClass:"",selected:!1,activityIds:""},setActivity:function(t){var e,i,o=[];for(this.set("activitiesIDs",t),i=t.split("#"),e=0;e<i.length;e+=1)o.push({id:i[e],visited:!1});i.length=0,i=null,this.set("activities",o)}}),s=Backbone.Collection.extend({model:l}),i=0;o>i;i+=1)e=new l,e.set("hotspotClass",d[i].hotspotClass),e.set("trackerClass",d[i].trackerClass),e.set("sectionId",d[i].id),e.setActivity(d[i].activity),this.model.get("defaultSelectedSection")===i&&(e.set("selected",!0),this.previousSelectedModel=e),r.push(e);this.collection=new s(r),this.model.on("change",$.proxy(this.onModelChange,this))},onRender:function(){this.$("#sectionNavigatorWrapper").addClass(this.model.get("sectionNavigatorWrapperStyle")),this.$("#sectionNavigatorWrapper").css("width",this.model.get("compLength")+"px")},onShow:function(){this.SectionNavigatorWrapper=this.$("#SectionNavigatorWrapper")},onModelChange:function(){},onSectionHotSpotClicked:function(t){this.previousSelectedModel.set("selected",!1),this.previousSelectedModel=this.collection.findWhere({sectionId:t.sectionId}),this.trigger(this.SECTION_SELECTED,t)},parseCompData:function(t,e){t&&(void 0!==t.compLength&&e.set("compLength",t.compLength),void 0!==t.defaultSelectedSection&&e.set("defaultSelectedSection",t.defaultSelectedSection),void 0!==t.sectionData&&e.set("sectionData",t.sectionData.section),void 0!==t.sectionNavigatorWrapperStyle&&this.model.set("sectionNavigatorWrapperStyle",t.sectionNavigatorWrapperStyle))}});return l.prototype.Super=o,l.prototype.activityVisited=function(t){var e,i,o,s,n,c,l;if(l=this.previousSelectedModel.cid,c=this.collection.filter(function(e){return 0===e.get("activitiesIDs").search(t)})[0],!c)throw"Activity Id doesn't exist!";for(i=c.get("activities"),o=i.length,e=0;o>e;e++)s=i[e],s.id===t&&(s.visited=!0,i[e]=s);for(n=[];i.length>0;)n.push(i.pop());c.set("activities",n),l!==c.cid&&(this.previousSelectedModel.set("selected",!1),this.previousSelectedModel=c,c.set("selected",!0))},l.prototype.flush=function(){var t;if(this.collection)for(;this.collection.first();)t=this.collection.first(),t.id=null,t.destroy(),t=null;this.model.id=null,this.model.destroy(),this.model=null,this.collection=null},l.prototype.SECTION_SELECTED="sectionSelected",l.prototype.destroy=function(){return this.off(c.SECTION_HOTSPOT_CLICKED,this.onSectionHotSpotClicked),this.flush(),this.unbind(),this.undelegateEvents(),this.children.call("destroy"),this.children.call("remove"),this.close(),this.Super.prototype.destroy(!0)},l});