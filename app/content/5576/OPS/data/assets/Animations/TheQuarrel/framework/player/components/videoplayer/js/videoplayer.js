define(["marionette","player/base/base-media-player","text!components/videoplayer/templates/videoplayer-tmpl.html","components/videoplayer/js/model/videoplayer-model"],function(e,t,o,i){var s=!1,n=!1,r=t.extend({template:_.template(o),initialize:function(e){this._objVideoElement=null,this.model=new i,this.arrOptionAttribute=["source","loop","width","height","controls","poster","customControlls"],this.listenTo(this.model,"change",this.onModelChange),this.initBaseMediaPlayer(this,this.PlayerConstants.VIDEO_MEDIA_PLAYER),void 0!==e?(e.hasOwnProperty("cuePoints")&&e.cuePoints.length>0&&(this.hasCuePoints=!0,this.cuePoints=e.cuePoints.slice(0,e.cuePoints.length),this.orgCuePoints=_.extend({},e.cuePoints),this.cuePoints.sort(function(e,t){return e-t})),e.hasOwnProperty("eventPrefix")&&void 0!==e.eventPrefix&&(this.eventPrefix=e.eventPrefix),e.hasOwnProperty("outerDiv")&&void 0!==e.outerDiv&&this.$el.addClass(e.outerDiv),this.setValuesInModel(e)):console.error("Please check provided data in video player constructor...")},setValuesInModel:function(e){var t,o;for(t=0;t<this.arrOptionAttribute.length;t+=1)if(void 0!==e[this.arrOptionAttribute[t]])switch(o=e[this.arrOptionAttribute[t]],this.arrOptionAttribute[t]){case"source":s=!0,this.model.set("data",o);break;case"loop":s=!1,this.model.set("loop",o);break;case"width":s=!1,this.model.set("vWidth",o);break;case"height":s=!1,this.model.set("vHeight",o);break;case"controls":s=!1,o="undefined"===o?void 0:o,this.model.set("vControls",o);break;case"poster":s=!1,o="undefined"===o?void 0:o,this.model.set("poster",o);break;case"customControlls":s=!1,o="undefined"===o?void 0:o,this.model.set("customControlls",o)}},onModelChange:function(){s===!0&&($(this._objVideoElement).off("ended"),$(this._objVideoElement).off("timeupdate"),$(this._objVideoElement).remove(),this._objVideoElement=null,this.render()),this._objVideoElement&&this.updateVideoLayout()},onRender:function(){this._objVideoElement=$(this.el).find("#objVideo")[0],this.onShow()},onShow:function(){this._objVideoElement=$(this.el).find("#objVideo")[0],$(this._objVideoElement).on("ended",this,this.finishHandler),$(this._objVideoElement).on("timeupdate",this,this.timeUpdateHandler),this.updateVideoLayout()},updateVideoLayout:function(){this._objVideoElement.setAttribute("width",this.model.get("vWidth")),this._objVideoElement.setAttribute("height",this.model.get("vHeight")),void 0!==this.model.get("vControls")&&this._objVideoElement.setAttribute("controls",this.model.get("vControls")),void 0!==this.model.get("poster")&&this._objVideoElement.setAttribute("poster",this.model.get("poster"))},timeUpdateHandler:function(e){var t,o=e.currentTarget;t=e.data,n!==!0&&(t.customEventDispatcher(t.VIDEO_PROGRESS_EVENT,t,{currentTime:o.currentTime}),t.hasCuePoints&&t.cuePointEventDispatcher(t,o.currentTime))},finishHandler:function(e){var t,o=e.currentTarget;t=e.data,t.customEventDispatcher(t.VIDEO_FINISH_EVENT,t),"true"===t.model.get("loop")&&(o.currentTime=0,o.play())}});return r.prototype.__super__=t,r.prototype.VIDEO_START_EVENT="videostart",r.prototype.VIDEO_PAUSE_EVENT="videopause",r.prototype.VIDEO_PROGRESS_EVENT="videoprogress",r.prototype.VIDEO_STOP_EVENT="videostop",r.prototype.VIDEO_FINISH_EVENT="videofinish",r.prototype.changeVideo=function(e){void 0!==e&&(e.hasOwnProperty("cuePoints")&&e.cuePoints.length>0&&(this.hasCuePoints=!0,this.cuePoints=e.cuePoints.slice(0,e.cuePoints.length),this.orgCuePoints=_.extend({},e.cuePoints),this.cuePoints.sort(function(e,t){return e-t}),this.lastCuePoint=-1),e.hasOwnProperty("eventPrefix")&&void 0!==e.eventPrefix&&(this.eventPrefix=e.eventPrefix),e.hasOwnProperty("outerDiv")&&void 0!==e.outerDiv&&this.$el.addClass(e.outerDiv),this.setValuesInModel(e))},r.prototype.play=function(){n=!1,this._objVideoElement.play(),this.customEventDispatcher(this.VIDEO_START_EVENT,this)},r.prototype.resume=function(){this.play()},r.prototype.pause=function(){this._objVideoElement.pause(),this.customEventDispatcher(this.VIDEO_PAUSE_EVENT,this)},r.prototype.stop=function(){this._objVideoElement.pause(),this._objVideoElement.currentTime=0,this.customEventDispatcher(this.VIDEO_STOP_EVENT,this)},r.prototype.changeVolume=function(e){this._objVideoElement.volume=e},r.prototype.setTime=function(e){if(e<=this._objVideoElement.duration&&e>=0){if(n=!0,this._objVideoElement.currentTime=e,void 0===this.cuePoints)return;for(var t=0;t<this.cuePoints.length&&1e3*e>=this.cuePoints[t];t+=1)this.lastCuePoint=this.cuePoints[t]}},r.prototype.getTime=function(){return this._objVideoElement.currentTime},r.prototype.getDuration=function(){return this._objVideoElement.duration},r.prototype.destroy=function(){return this.unregisterMedia(),this.model.destroy(),this.remove(),this._objVideoElement=null,this.__super__.prototype.destroy(!0)},r});