define(["marionette","jqueryUI","jqueryTouchPunch","player/base/base-item-comp","text!components/slider/template/slider.html","components/slider/model/slider-model","components/slider/js/sliderconst","css!components/slider/template/style/slider.css"],function(t,i,e,s,o,n,h){var l=s.extend({template:_.template(o),isRangeSlider:!1,objThumbMin:null,objThumbMax:null,objSlidingBar:null,objBackground:null,objBoundingBox:null,objCompBlocker:null,padding:0,thumbIndex:1,compData:null,click:{},previousPosition:null,lowerZIndexValue:1,higherZIndexValue:2,orgPos:{thumbMin:null,thumbMax:null},initialize:function(t){this.initializeComp(t)},initializeComp:function(t){void 0!==t&&void 0!==t.updatedScale&&this.setStageScaleValue(t.updatedScale),this.previousPosition={},this.orgPos={thumbMin:null,thumbMax:null},this.click={},this.compData=t,this.model=new n,this.parseCompData(this,t,this.model),this.model.set("stepsPosition",this.getMajorTicks())},onRender:function(){this.$("#sliderWrapper").addClass(this.model.get("sliderWrapperStyle")),this.initSlider()},onShow:function(){this.configureView(this)},initSlider:function(){this.objBackground=this.$("#sliderWrapper"),this.objBoundingBox=this.$("#boundingBox"),this.objSlidingBar=this.$("#slidingBar"),this.objThumbMin=this.$("#thumbMin"),this.objCompBlocker=this.$("#compBlocker"),this.minThumbZindex=this.objThumbMin.css("z-index"),this.isRangeSlider&&(this.objThumbMax=this.$("#thumbMax"),this.objThumbMax.addClass("SliderThumbStyle"),this.maxThumbZindex=this.objThumbMax.css("z-index")),this.attachDragEvent()},attachDragEvent:function(){$(this.objThumbMin).draggable({axis:this.model.get("allignment")===h.CONSTANTS.HORIZONTAL?"x":"y",containment:this.objBoundingBox,scroll:!1,start:$.proxy(this.onDraggingStart,this),drag:$.proxy(this.onDragging,this),stop:$.proxy(this.onDraggingStop,this)}),$(this.objThumbMin).on("mousedown",this,this.mouseInteractionOnThumb),$(this.objThumbMin).on("mouseup",this,this.mouseInteractionOnThumb),this.isRangeSlider&&($(this.objThumbMax).draggable({axis:this.model.get("allignment")===h.CONSTANTS.HORIZONTAL?"x":"y",containment:this.objBoundingBox,scroll:!1,start:$.proxy(this.onDraggingStart,this),drag:$.proxy(this.onDragging,this),stop:$.proxy(this.onDraggingStop,this)}),$(this.objThumbMax).on("mousedown",this,this.mouseInteractionOnThumb),$(this.objThumbMax).on("mouseup",this,this.mouseInteractionOnThumb))},mouseInteractionOnThumb:function(t){"mousedown"===t.type?t.data.customEventDispatcher(h.EVENTS.MOUSEDOWN_ON_THUMB,t.data,t.target.id):t.data.customEventDispatcher(h.EVENTS.MOUSEUP_ON_THUMB,t.data,t.target.id)},updateZIndex:function(t){$(t).css("z-index",this.higherZIndexValue),"thumbMin"===t.id?$("#thumbMax").css("z-index",this.lowerZIndexValue):$("#thumbMin").css("z-index",this.lowerZIndexValue)},onDraggingStart:function(t){var i,e;i=t.target.id,this.isRangeSlider&&this.updateZIndex(t.target),this.click.x=t.clientX,this.click.y=t.clientY,e=this.model.get("currentPercentage"),this.customEventDispatcher(h.EVENTS.SLIDING_STARTED,this,e[i])},onDragging:function(t,i){var e,s,o,n,l,r;l=t.target,r=t.target.id,n=i.originalPosition,null!==this.orgPos[r]?(s=(t.clientX-this.click.x+this.orgPos[r].left*this.getStageScaleValue())/this.getStageScaleValue(),o=(t.clientY-this.click.y+this.orgPos[r].top*this.getStageScaleValue())/this.getStageScaleValue()):(s=(t.clientX-this.click.x+n.left)/this.getStageScaleValue(),o=(t.clientY-this.click.y+n.top)/this.getStageScaleValue()),this.isThumbWithinboundary(l,i,s,o)&&(e=this.model.get("allignment")===h.CONSTANTS.HORIZONTAL?this.getPercentage(s,this.model.get("sliderLength")):this.getPercentage(this.model.get("sliderLength")-o,this.model.get("sliderLength")),this.customEventDispatcher(h.EVENTS.SLIDING_IN_PROGRESS,this,e))},onDraggingStop:function(t,i){var e,s,o,n,l={},r={};if(s=t.target.id,o=t.target,this.model.get("allignment")===h.CONSTANTS.HORIZONTAL)if(2!==this.model.get("steps")){if(e=this.findNearestMajorStep(i.position.left),n=this.getPercentage(e,this.model.get("sliderLength")),n<this.model.get("minSlidingPostion"))return;this.orgPos[s]=i.position,l=this.model.get("currentPosition"),l[s]=e,this.model.set("currentPosition",l),r=this.model.get("currentPercentage"),r[s]=this.getPercentage(e,this.model.get("sliderLength")),this.model.set("currentPercentage",r),$(o).css("left",e+"px"),this.orgPos[s].left=e}else this.orgPos[s]=i.position,l=this.model.get("currentPosition"),l[s]=i.position.left,this.model.set("currentPosition",l),r=this.model.get("currentPercentage"),r[s]=this.getPercentage(i.position.left,this.model.get("sliderLength")),this.model.set("currentPercentage",r);else this.orgPos[s]=i.position,2!==this.model.get("steps")?(e=this.findNearestMajorStep(i.position.top),l=this.model.get("currentPosition"),l[s]=this.model.get("sliderLength")-e,this.model.set("currentPosition",l),r=this.model.get("currentPercentage"),r[s]=this.getPercentage(this.model.get("sliderLength")-e,this.model.get("sliderLength")),this.model.set("currentPercentage",r),$(o).css("top",e+"px"),this.orgPos[s].top=e):(l=this.model.get("currentPosition"),l[s]=this.model.get("sliderLength")-i.position.top,this.model.set("currentPosition",l),r=this.model.get("currentPercentage"),r[s]=this.getPercentage(this.model.get("sliderLength")-i.position.top,this.model.get("sliderLength")),this.model.set("currentPercentage",r));this.previousPosition=this.orgPos[s],this.customEventDispatcher(h.EVENTS.SLIDING_STOPPED,this,r[s])},isThumbWithinboundary:function(t,i,e,s){var o,n,l,r=!1,a={};return a=this.getBoundaryValues(t,i,e,s),o=a.minValue,n=a.maxValue,l=a.calculatedPos,this.model.get("allignment")===h.CONSTANTS.HORIZONTAL?e>o&&n>=e?(i.position.left=e,i.position.top=s,r=!0):o>=e?(i.position.left=o,i.position.top=s):e>n&&(i.position.left=n,i.position.top=s):l>o&&n>=l?(i.position.top=s,i.position.left=e,r=!0):o>=l?(i.position.top=this.model.get("sliderLength")-o,i.position.left=e):l>n&&(i.position.top=this.model.get("sliderLength")-n,i.position.left=e),r},getBoundaryValues:function(t,i,e,s){var o,n,l,r,a,d={},u={};return o=this.model.get("minSlidingPostion")*this.model.get("sliderLength")/100,n=this.model.get("maxSlidingPostion")*this.model.get("sliderLength")/100,r=this.model.get("currentPosition"),this.isRangeSlider?this.model.get("allignment")===h.CONSTANTS.HORIZONTAL?"thumbMin"===t.id?(l=r.thumbMax,n=n>l?l:n):(l=r.thumbMin,o=o>l?o:l):(u=this.getVerticalBoundaryValues(t,i,e,s,o,n),o=u.minValue,n=u.maxValue,a=u.calculatedPos):this.model.get("allignment")===h.CONSTANTS.VERTICAL&&(u=this.getVerticalBoundaryValues(t,i,e,s,o,n),o=u.minValue,n=u.maxValue,a=u.calculatedPos),d.minValue=o,d.maxValue=n,d.calculatedPos=a,d},getVerticalBoundaryValues:function(t,i,e,s,o,n){var h,l,r,a={};return l=this.model.get("currentPosition"),"thumbMin"===t.id?(h=l.thumbMax,r=this.model.get("sliderLength")-s,n=n>h?h:n):(h=l.thumbMin,r=this.model.get("sliderLength")-s,o=o>h?o:h),a.calculatedPos=r,a.minValue=o,a.maxValue=n,a},getPercentage:function(t,i){var e=t/i*100;return e},findNearestMajorStep:function(t){var i,e,s,o=null;return s=this.model.get("stepsPosition"),e=s.length,$.each(s,function(){(null===o||Math.abs(this-t)<Math.abs(o-t))&&(o=this)}),i=Number(o)},configureView:function(){var t,i,e={},s={},o={};e=this.model.get("defalutPosition"),t=e.thumbMin,i=t*this.model.get("sliderLength")/100,s.thumbMin=i,o.thumbMin=t,this.model.get("allignment")===h.CONSTANTS.HORIZONTAL?(this.padding=$(this.objThumbMin).width()/2,$(this.objBackground).css("width",this.model.get("sliderLength")+2*this.padding+"px"),$(this.objBackground).css("position","relative"),$(this.objSlidingBar).css("width",this.model.get("sliderLength")+"px"),$(this.objSlidingBar).css("left",this.padding+"px"),$(this.objSlidingBar).css("position","absolute"),$(this.objThumbMin).css("left",s.thumbMin+"px"),$(this.objThumbMin).css("position","absolute"),this.isRangeSlider&&(t=e.thumbMax,i=t*this.model.get("sliderLength")/100,s.thumbMax=i,o.thumbMax=t,$(this.objThumbMax).css("left",s.thumbMax+"px"),$(this.objThumbMax).css("position","absolute"))):(this.padding=$(this.objThumbMin).height()/2,$(this.objBackground).css("height",this.model.get("sliderLength")+2*this.padding+"px"),$(this.objBackground).css("position","relative"),$(this.objSlidingBar).css("height",this.model.get("sliderLength")+"px"),$(this.objSlidingBar).css("top",this.padding+"px"),$(this.objSlidingBar).css("position","absolute"),$(this.objThumbMin).css("top",this.model.get("sliderLength")-s.thumbMin+"px"),$(this.objThumbMin).css("position","absolute"),this.isRangeSlider&&(t=e.thumbMax,i=t*this.model.get("sliderLength")/100,s.thumbMax=i,o.thumbMax=t,$(this.objThumbMax).css("top",this.model.get("sliderLength")-s.thumbMax+"px"),$(this.objThumbMax).css("position","absolute"))),this.model.set("currentPosition",s),this.model.set("currentPercentage",o)},parseCompData:function(t,i,e){var s,o,n;s={thumbMin:null,thumbMax:null},i.sliderWrapperStyle!==e.get("sliderWrapperStyle")&&void 0!==i.sliderWrapperStyle?e.set("sliderWrapperStyle",i.sliderWrapperStyle):e.set("sliderWrapperStyle","SliderHorizontalWrapperStyle"),void 0!==i.sliderLength&&(n=parseInt(i.sliderLength,10),n!==e.get("sliderLength")&&e.set("sliderLength",n)),void 0!==i.steps&&(n=parseInt(i.steps,10),n!==e.get("steps")&&e.set("steps",n)),void 0!==i.allignment&&i.allignment!==e.get("allignment")&&e.set("allignment",i.allignment),void 0!==i.minSlidingPostion?(n=parseInt(i.minSlidingPostion,10),n!==e.get("minSlidingPostion")&&e.set("minSlidingPostion",n)):e.set("minSlidingPostion",0),void 0!==i.maxSlidingPostion?(n=parseInt(i.maxSlidingPostion,10),n!==e.get("maxSlidingPostion")&&e.set("maxSlidingPostion",n)):e.set("maxSlidingPostion",100),void 0!==i.defalutPosition&&(i.defalutPosition instanceof Array&&(t.isRangeSlider=!0),o=t.getValidatedDefaultPosition(i),s.thumbMin=o.thumbMin,s.thumbMax=o.thumbMax,e.set("defalutPosition",s))},getValidatedDefaultPosition:function(t){var i,e,s,o,n;return s={thumbMin:null,thumbMax:null},i=this.model.get("minSlidingPostion"),e=this.model.get("maxSlidingPostion"),o=parseInt(t.defalutPosition[0],10),n=parseInt(t.defalutPosition[1],10),this.isRangeSlider?(s.thumbMin=o>=i&&e>=o&&n>=o?o:this.model.get("minSlidingPostion"),s.thumbMax=e>=n&&n>=i&&n>=o?n:this.model.get("maxSlidingPostion")):s.thumbMin=t.defalutPosition>=i&&t.defalutPosition<=e?t.defalutPosition:this.model.get("minSlidingPostion"),s},resetSlider:function(){var t,i={},e=[];this.initializeComp(this.compData),i=this.model.get("defalutPosition"),this.isRangeSlider?(e=[i.thumbMin,i.thumbMax],this.updateThumbPosition(e)):(t=i.thumbMin,this.updateThumbPosition(t))},getMajorTicks:function(){var t,i,e,s,o;for(t=[],i=this.model.get("steps"),e=this.model.get("sliderLength"),s=e/i,o=0;i>=o;o+=1)t.push(o*s);return t},updateThumbPosition:function(t){var i={},e={};i=this.model.get("currentPosition"),e=this.model.get("currentPercentage"),t instanceof Array?(i.thumbMin=t[0]*this.model.get("sliderLength")/100,e.thumbMin=t[0],i.thumbMax=t[1]*this.model.get("sliderLength")/100,e.thumbMax=t[1],this.setThumbPosition(this.objThumbMin,"thumbMin",i.thumbMin),this.setThumbPosition(this.objThumbMax,"thumbMax",i.thumbMax)):(i.thumbMin=t*this.model.get("sliderLength")/100,e.thumbMin=t,this.setThumbPosition(this.objThumbMin,"thumbMin",i.thumbMin)),this.model.set("currentPosition",i),this.model.set("currentPercentage",e)},setThumbPosition:function(t,i,e){var s;$(t).css("height",$(t).height()+"px"),$(t).css("width",$(t).width()+"px"),$(t).css("position","absolute"),this.model.get("allignment")===h.CONSTANTS.HORIZONTAL?($(t).css("left",e+"px"),this.orgPos[i]?this.orgPos[i].left=e:this.orgPos[i]={left:e,top:$("#"+i).css("top")}):(s=this.model.get("sliderLength")-e,$(t).css("top",+s+"px"),this.orgPos[i]?this.orgPos[i].top=s:this.orgPos[i]={left:$("#"+i).css("left"),top:s})}});return l.prototype.Super=s,l.prototype.getCurrentPosition=function(){var t={},i=this.model.get("currentPercentage");return this.isRangeSlider?(t.minValue=i.thumbMin,t.maxValue=i.thumbMax,t):i.thumbMin},l.prototype.setCurrentPosition=function(t){this.updateThumbPosition(t)},l.prototype.enableSlider=function(){this.objCompBlocker.css("width","0"),this.objCompBlocker.css("height","0"),this.objCompBlocker.css("z-index","0")},l.prototype.disableSlider=function(){this.objCompBlocker.css("width","100%"),this.objCompBlocker.css("height","100%"),this.objCompBlocker.css("z-index","1000"),this.objCompBlocker.css("opacity",".5")},l.prototype.maxSliderPosition=function(t){this.compData.maxSlidingPostion=t,this.resetSlider()},l.prototype.minSliderPosition=function(t){this.compData.minSlidingPostion=t,this.resetSlider()},l.prototype.flush=function(){this.model.id=null,this.model.destroy(),this.model=null},l.prototype.destroy=function(){return this.objThumbMin=null,this.objSlidingBar=null,this.objBackground=null,this.objBoundingBox=null,this.padding=0,this.flush(),this.unbind(),this.undelegateEvents(),this.close(),this.Super.prototype.destroy(!0)},l});