define(["marionette","player/base/base-composite-comp","components/table/js/custom-table-helper","text!components/table/template/custom-table-tmpl.html"],function(e,t,s,o){var i=t.extend({template:_.template(o),tagName:"table",TABLE_TASK:"tableTask",DELETE_ROW:"deleteRow",ADD_ROW:"",UPDATE_ROW:"updateRow",SELECT_ROW:"selectRow",clsPostfix:"-selected",arrHookedEvent:[],dataProvider:null,customTableCollection:null,customTableModel:null,hasItemRenderer:!1,initialize:function(e){e&&e.hasOwnProperty("model")||(this.isDataProviderSet=!1,s.doConfiguration(this,e),e&&(e.hasOwnProperty(s.CONST_TABLE_DATA)&&s.init(this,e),e.hasOwnProperty(s.CONST_ITEM_RENDERER)?(this.hasItemRenderer=!0,s.setItemRenderer(this,e.itemRenderer)):(this.hasItemRenderer=!1,s.setItemRenderer(this)),this.on(this.TABLE_TASK,s.handleTablesTask,this)))},appendHtml:function(e,t,s){var o,i=e.$(this.itemViewContainer);o=i.children().length,this.irClassName&&t.$el.removeAttr("class").addClass(this.irClassName),t.$el.attr("data-cid",t.model.cid),0>=o?i.append(t.el):0>=s?i.prepend(t.el):$(i.children()[s-1]).after(t.el)},onRender:function(){this.customTableModel&&this.$el.removeAttr("class").addClass(this.customTableModel.get("className"))}});return i.prototype.Super=t,i.prototype.setClassName=function(e){void 0!==e&&""!==e&&(this.collectionTableModel.set("className",e),this.$el.removeAttr("class").addClass(e))},i.prototype.setItemRendererClassName=function(e){e&&""!==e&&(this.irClassName=e,this.$(this.itemViewContainer+" tr").removeAttr("class").addClass(e))},i.prototype.setDataProvider=function(e){e?s.changeDataProvider(this,e):console.warn("Please provide data for table!")},i.prototype.getDataProvider=function(){return s.customTableCollection.toJSON()},i.prototype.hookEvent=function(e,t,s){var o={callbackRef:e,callback:s};switch(this.arrHookedEvent[t]=o,t){case this.ADD_ROW:this.on(this.ADD_ROW,$.proxy(e[s],e));break;case this.DELETE_ROW:this.on(this.DELETE_ROW,$.proxy(e[s],e));break;case this.UPDATE_ROW:this.on(this.UPDATE_ROW,$.proxy(e[s],e));break;case this.SELECT_ROW:this.$(this.itemViewContainer).on("click","tr",o,$.proxy(this.handleRowClick,this))}},i.prototype.handleRowClick=function(e){var t,o,i,a,l=$(e.currentTarget);a=this.customTableModel.get("selectionMode"),t=l.attr("data-cid"),o=this.children.findByModelCid(t).model.get("index"),l.hasClass(this.irClassName+this.clsPostfix)?(l.removeClass(this.irClassName+this.clsPostfix).addClass(this.irClassName),a===s.CONST_SINGLE?this.customTableModel.set("selectedIndex",this.customTableModel.defaults.selectedIndex):this.customTableModel.removeFromIndices(o)):a===s.CONST_SINGLE?(i=this.$(this.itemViewContainer+" tr[class $='"+this.clsPostfix+"']"),void 0!==i&&i.removeClass(this.irClassName+this.clsPostfix).addClass(this.irClassName),l.removeClass(this.irClassName).addClass(this.irClassName+this.clsPostfix),this.customTableModel.set("selectedIndex",o)):(l.removeClass(this.irClassName).addClass(this.irClassName+this.clsPostfix),this.customTableModel.updateSelectedIndices(o)),e.data.callbackRef[e.data.callback]({type:this.SELECT_ROW})},i.prototype.unhookEvent=function(e){switch(e){case this.ADD_ROW:this.off(this.ADD_ROW);break;case this.DELETE_ROW:this.off(this.DELETE_ROW);break;case this.UPDATE_ROW:this.off(this.UPDATE_ROW);break;case this.SELECT_ROW:this.$(this.itemViewContainer).off("click","tr")}},i.prototype.addRow=function(e,t){s.addRow(this,e,t)},i.prototype.deleteRow=function(e){s.deleteRow(this,e)},i.prototype.updateRow=function(e,t){s.updateRow(this,e,t)},i.prototype.getSelectedIndex=function(){return this.customTableModel.get("selectedIndex")},i.prototype.getSelectedIndices=function(){var e;return e=this.customTableModel.get("selectionMode")===s.CONST_SINGLE?[this.customTableModel.get("selectedIndex")]:this.customTableModel.get("selectedIndices")},i.prototype.getRowDataAt=function(e){return this.customTableCollection.getModelByIndex(e).toJSON()},i.prototype.getSelectedRowsData=function(){var e,t,s=[];if(t=this.getSelectedIndices(),t.length>0)for(e=0;e<t.length;e+=1)s.push(this.customTableCollection.getModelByIndex(t[e]).toJSON());return s},i.prototype.destroy=function(){return this.off(this.TABLE_TASK,s.handleCommonTask),this.unhookEvent(this.ADD_ROW),this.unhookEvent(this.DELETE_ROW),this.unhookEvent(this.UPDATE_ROW),this.unhookEvent(this.SELECT_ROW),s.flush(this),s.destroy(this),this.close(),this.Super.prototype.destroy(!0)},i});