define(["marionette","player/base/base-media-player"],function(t,e){var i,o=e.extend({template:_.template(""),video:document.createElement("video"),state:-1,bloop:!1,initialize:function(t){this.initBaseMediaPlayer(this,this.PlayerConstants.VIDEO_MEDIA_PLAYER),void 0!==t?(this.addEvents(),this.setLayout(t),this.setCuePoints(t),this.setSource(t),void 0!==t.loop&&(this.bloop="true"===t.loop||t.loop===!0?!0:!1)):console.error("Please check provided data in video player constructor...")},onShow:function(){this.$el.append($(this.video)),this.video.load()}});return o.prototype.setLayout=function(t){t.hasOwnProperty("outerDiv")&&void 0!==t.outerDiv&&this.$el.addClass(t.outerDiv),t.hasOwnProperty("width")&&$(this.video).attr("width",t.width),t.hasOwnProperty("height")&&$(this.video).attr("height",t.height),t.hasOwnProperty("poster")&&t.poster.length>0&&$(this.video).attr("poster",t.poster),t.hasOwnProperty("controls")&&void 0!==t.controls&&$(this.video).attr("controls","")},o.prototype.setCuePoints=function(t){t.hasOwnProperty("cuePoints")&&t.cuePoints.length>0&&(this.hasCuePoints=!0,this.cuePoints=t.cuePoints.slice(0,t.cuePoints.length),this.orgCuePoints=_.extend({},t.cuePoints),this.cuePoints.sort(function(t,e){return t-e})),t.hasOwnProperty("eventPrefix")&&void 0!==t.eventPrefix&&(this.eventPrefix=t.eventPrefix)},o.prototype.setSource=function(t){var e,i,o;if(t.source.length>0)for($(this.video).empty(),this.state=-1,e=0;e<t.source.length;e+=1)i=t.source[e],o=document.createElement("source"),o.setAttribute("src",i.path),this.video.appendChild(o)},o.prototype.addEvents=function(){this.video.addEventListener("loadstart",$.proxy(this.loadstart,this)),this.video.addEventListener("ended",$.proxy(this.ended,this)),this.video.addEventListener("loadedmetadata",$.proxy(this.loadedmetadata,this)),this.video.addEventListener("canplay",$.proxy(this.canplay,this)),this.video.addEventListener("timeupdate",$.proxy(this.timeupdate,this))},o.prototype.loadstart=function(){i=!1,this.state=0},o.prototype.loadedmetadata=function(){this.state=1},o.prototype.canplay=function(){this.state=2},o.prototype.ended=function(){this.customEventDispatcher(this.VIDEO_FINISH_EVENT,this,this.video.currentTime),this.bloop&&(this.video.currentTime=0,this.video.play())},o.prototype.timeupdate=function(){return i?(this.customEventDispatcher("seeking",this,{currentTime:this.video.currentTime}),i=!1,void 0):(this.customEventDispatcher(this.VIDEO_PROGRESS_EVENT,this,{currentTime:this.video.currentTime}),this.hasCuePoints&&this.cuePointEventDispatcher(this,this.video.currentTime),void 0)},o.prototype.__super__=e,o.prototype.VIDEO_START_EVENT="videostart",o.prototype.VIDEO_PAUSE_EVENT="videopause",o.prototype.VIDEO_PROGRESS_EVENT="videoprogress",o.prototype.VIDEO_STOP_EVENT="videostop",o.prototype.VIDEO_FINISH_EVENT="videofinish",o.prototype.changeVideo=function(t){void 0!==t&&(this.setLayout(t),this.setCuePoints(t),this.setSource(t),void 0!==t.loop&&(this.bloop="true"===t.loop||t.loop===!0?!0:!1)),this.state<0&&this.video.load()},o.prototype.play=function(){2===this.state?(this.video.play(),this.customEventDispatcher(this.VIDEO_START_EVENT,this,this.video.currentTime)):this.state<2&&this.waitAndPlay()},o.prototype.waitAndPlay=function(){var t=this;setTimeout(function(){t.play()},1)},o.prototype.resume=function(){this.play()},o.prototype.pause=function(){this.video.pause(),this.customEventDispatcher(this.VIDEO_PAUSE_EVENT,this.video.currentTime)},o.prototype.stop=function(){this.video.pause(),this.video.currentTime=0,this.customEventDispatcher(this.VIDEO_STOP_EVENT,this.video.currentTime)},o.prototype.changeVolume=function(t){this.video.volume=t},o.prototype.setTime=function(t){if(t<=this.video.duration&&t>=0){if(i=!0,this.video.currentTime=t,void 0===this.cuePoints)return;for(var e=0;e<this.cuePoints.length&&1e3*t>=this.cuePoints[e];e+=1)this.lastCuePoint=this.cuePoints[e]}},o.prototype.getTime=function(){return this.video.currentTime},o.prototype.getDuration=function(){return this.video.duration},o.prototype.destroy=function(){return this.video.removeEventListener("loadstart",$.proxy(this.loadstart,this)),this.video.removeEventListener("ended",$.proxy(this.ended,this)),this.video.removeEventListener("loadedmetadata",$.proxy(this.loadedmetadata,this)),this.video.removeEventListener("canplay",$.proxy(this.canplay,this)),this.video.removeEventListener("timeupdate",$.proxy(this.timeupdate,this)),this.unregisterMedia(),this.__super__.prototype.destroy(!0)},o});