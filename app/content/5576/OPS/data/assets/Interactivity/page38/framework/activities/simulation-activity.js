define(["player/base/base-simulation-activity","player/utils/data-loader","frameworkRoot/activities/simulation-model"],function(t,a){var o=t.extend({template:_.template("<div>simulation activity</div>"),activityData:void 0,jsonData:void 0,objDataLoader:void 0,regions:{screenHolder:"#screenHolder",globalCompHolder:"#globalCompHolder"},initialize:function(t){this.initBaseActivity(),this.activityData=t}});return o.prototype.onActivityCreationComplete=function(){this.broadcastEventReceiver(this.ActivityEventConst.MANAGE_COMMON_BROADCAST_EVENT,this,"manageCommonBroadcastEvent");var t=this.activityData;this.objDataLoader=new a,void 0!==t.dataPath&&this.loadJSONData(t.dataPath,"json","application/json","json",this.handleJsonDataLoadComplete,this.dataLoadErrorHandler),void 0!==this.localText&&this.setLocalText()},o.prototype.manageCommonBroadcastEvent=function(t){if(this.strRegionName===t.data.region)switch(t.type){case this.ActivityEventConst.MANAGE_COMMON_BROADCAST_EVENT:switch(t.data.subTask){case this.ActivityEventConst.CALL_AND_UPDATE_COMPONENT:delete t.data.region,this.objSimPictor.callAndUpdateComponent(t.data)}}},o.prototype.__super__=t,o.prototype.setPictorRef=function(t){this.objSimPictor=t},o.prototype.handleJsonDataLoadComplete=function(t,a){a.jsonData=t,a.objDataLoader.off(a.objDataLoader.DATA_LOAD_SUCCESS),a.objDataLoader.off(a.objDataLoader.DATA_LOAD_FAILED),void 0!==t.defaults&&$.each(t.defaults,function(t,o){a.model.set(t,o)}),void 0!==a.activityData.stylePath?a.loadCSSData(a.activityData.stylePath):a.onAllDataLoadComplete()},o.prototype.onAllDataLoadComplete=function(){this.initlizeControls(),this.startScreenInitlization()},o.prototype.dataLoadErrorHandler=function(){throw this.objDataLoader.off(this.objDataLoader.DATA_LOAD_SUCCESS),this.objDataLoader.off(this.objDataLoader.DATA_LOAD_FAILED),new Error(this.objErrConst.ERROR_WHILE_LOADING_FILE)},o.prototype.loadCSSData=function(t){var a=this;require(["css!"+t+"?"+(new Date).getTime()],function(){a.onAllDataLoadComplete()})},o.prototype.destroy=function(){return this.screenHolder.close(),void 0!==this.activityData.stylePath&&this.removeCSS(this.activityData.stylePath.split(".css")[0]),this.objSimPictor.destroy(),delete this.objSimPictor,this.removeJS("player/base/base-simulation-activity"),this.__super__.prototype.destroy(!0)},o});