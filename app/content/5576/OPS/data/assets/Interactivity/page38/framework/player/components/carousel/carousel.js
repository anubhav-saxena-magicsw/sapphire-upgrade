define(["marionette","jqueryUI","jqueryTouchPunch","player/base/base-composite-comp","text!components/carousel/template/carousel.html","components/carousel/model/carousel-model","components/carousel/js/carousel-constants","player/components/carousel/js/carousel-item","css!components/carousel/template/style/carousel.css"],function(e,t,i,o,s,n,r,l){var a=o.extend({objNextButton:null,currentPlayer:"p1",nextButtonCounter:0,isNextDisabled:!1,objPreviousButton:null,previousButtonCounter:0,isPreviousDisabled:!1,objImageContainer:null,template:_.template(s),itemView:l,itemViewContainer:"#imageContainer",initialize:function(e){var t,i,o,s,l,a=[],u={};if(this.model=new n,this.parseCompData(e,this.model),u=this.model.get("imageCollection"),l=Backbone.Model.extend({defaults:{imgSource:"",styleName:"",playerId:"",itemId:"",selected:!1,allignment:r.CONSTANTS.HORIZONTAL}}),s=Backbone.Collection.extend({model:l}),this.model.get("wrap")===r.CONSTANTS.LINEAR)for(o=this.model.get("selectorIndex"),i=0;o>i;i+=1)t=new l,t.set("imgSource",u.images[0].src),t.set("styleName","InvisibleItem"),t.set("itemId","-1"),t.set("allignment",this.model.get("allignment")),a.push(t);for(o=u.images.length,this.previousButtonCounter=o-1,i=0;o>i;i+=1)t=new l,t.set("imgSource",u.images[i].src),t.set("styleName",u.images[i].styleName),t.set("itemId",u.images[i].id),t.set("allignment",this.model.get("allignment")),a.push(t);this.collection=new s(a)},setCurrentPlayer:function(e){this.currentPlayer=e},onCarouselItemSelected:function(e){var t,i;t=this.collection.findWhere({playerId:this.currentPlayer}),t&&(t.set("playerId",""),t.set("selected",!1)),i=this.collection.get(e),i.set("playerId",this.currentPlayer),i.set("selected",!0)},updateNextPreviousButtonAvailability:function(e,t,i){if(this.model.get("wrap")===r.CONSTANTS.LINEAR){var o=this.model.get("imageCollection").images.length;t===o-1?($(e.objPreviousButton).removeClass("active"),e.isPreviousDisabled=!0):($(e.objPreviousButton).addClass("active"),e.isPreviousDisabled=!1),console.log("iLen:"+o+" nextCounter:"+i),i===o-1?($(e.objNextButton).removeClass("active"),e.isNextDisabled=!0):($(e.objNextButton).addClass("active"),e.isNextDisabled=!1)}else this.isNextDisabled=!1,$(e.objNextButton).addClass("active"),this.isPreviousDisabled=!1,$(e.objPreviousButton).addClass("active")},onRender:function(){this.$("#carouselWrapper").addClass(this.model.get("carouselWrapperStyle"))},onShow:function(){var e,t,i,o;this.objNextButton=this.$("#btnNext"),this.objPreviousButton=this.$("#btnPrevious"),this.objImageContainer=this.$("#imageContainer"),o=this,o.updateNextPreviousButtonAvailability(this,this.previousButtonCounter,this.nextButtonCounter),this.objNextButton.on("click",function(){o.onNextButtonClicked(o)}),this.objPreviousButton.on("click",function(){o.onPreviousButtonClicked(o)}),e=this.model.get("allignment"),t=$(this.itemViewContainer).parent(),i=$(this.itemViewContainer).find("img")[0],e===r.CONSTANTS.HORIZONTAL?($(this.itemViewContainer).css("overflow-x","hidden"),$(this.itemViewContainer).css("overflow-y","hidden"),$(this.itemViewContainer).css("white-space","nowrap")):($(this.itemViewContainer).css("overflow-y","hidden"),$(this.itemViewContainer).css("overflow-x","hidden"),$(this.itemViewContainer).css("white-space","normal")),this.trigger(r.EVENTS.COMPONENT_INITIALIZED,this.getCurrentItem()),this.$el.on("click",$.proxy(o.compClick,o)),this.$el.on("mouseover",$.proxy(o.compRollover,o)),this.$el.on("mouseout",$.proxy(o.compRollout,o))},onNextButtonClicked:function(e){if(!e.isNextDisabled){var t=$("#imageContainer :first");$(t).remove(),$("#imageContainer").append(t),e.model.get("wrap")===r.CONSTANTS.LINEAR&&(e.nextButtonCounter+=1,e.previousButtonCounter-=1,e.updateNextPreviousButtonAvailability(e,e.previousButtonCounter,e.nextButtonCounter)),this.trigger(r.EVENTS.INDEX_CHANGED,this.getCurrentItem())}},onPreviousButtonClicked:function(e){if(!e.isPreviousDisabled){var t=$("#imageContainer :last");console.log("divToMove",t),$(t).remove(),$("#imageContainer").prepend(t),e.model.get("wrap")===r.CONSTANTS.LINEAR&&(e.previousButtonCounter+=1,e.nextButtonCounter-=1,e.updateNextPreviousButtonAvailability(e,e.previousButtonCounter,e.nextButtonCounter)),this.trigger(r.EVENTS.INDEX_CHANGED,this.getCurrentItem())}},getCurrentDivId:function(){var e,t,i;return e="#imageContainer :nth-child("+(this.model.get("selectorIndex")+1)+")",t=$(e),i=$(t).attr("data-cid")},parseCompData:function(e,t){e&&(void 0!==e.carouselWrapperStyle?t.set("carouselWrapperStyle",e.carouselWrapperStyle):t.set("carouselWrapperStyle","CarouselHorizontalWrapperStyle"),e.allignment!==t.get("allignment")&&void 0!==e.allignment&&t.set("allignment",e.allignment),e.scroll!==t.get("scroll")&&void 0!==e.scroll&&t.set("scroll",e.scroll),e.wrap!==t.get("wrap")&&void 0!==e.wrap&&t.set("wrap",e.wrap),void 0!==e.imageCollection&&t.set("imageCollection",e.imageCollection),e.isSwapRequired!==t.get("isSwapRequired")&&void 0!==e.isSwapRequired&&t.set("isSwapRequired",e.isSwapRequired),e.isSelectorRequired!==t.get("isSelectorRequired")&&void 0!==e.isSelectorRequired&&t.set("isSelectorRequired",e.isSelectorRequired),e.selectorIndex!==t.get("selectorIndex")&&void 0!==e.selectorIndex&&t.set("selectorIndex",e.selectorIndex),e.playerIds!==t.get("playerIds")&&void 0!==e.playerIds&&t.set("playerIds",e.playerIds))}});return a.prototype.Super=o,a.prototype.isDisabledForCurrentUser=function(){var e;return e=this.collection.at(this.model.get("selectorIndex")),this.currentPlayer===this.model.get("playerId")?!1:!0},a.prototype.getCurrentItem=function(){var e,t,i={};return t=this.getCurrentDivId(),e=this.collection.get(t),e&&(i={itemId:e.get("itemId"),selected:e.get("selected")}),i},a.prototype.setCurrentItem=function(){this.onCarouselItemSelected(this.getCurrentDivId())},a.prototype.currentPlayer=function(e){this.setCurrentPlayer(e)},a.prototype.flush=function(){var e;if(this.collection)for(;this.collection.first();)e=this.collection.first(),e.id=null,e.destroy(),e=null;this.model.id=null,this.model.destroy(),this.model=null,this.collection=null},a.prototype.destroy=function(){return this.$el.off("click"),this.$el.off("mouseover"),this.$el.off("mouseout"),this.objNextButton.off("click",function(){this.onNextButtonClicked(this)}),this.objPreviousButton.off("click",function(){this.onPreviousButtonClicked(this)}),this.objNextButton=null,this.objPreviousButton=null,this.objImageContainer=null,this.flush(),this.unbind(),this.undelegateEvents(),this.children.call("destroy"),this.children.call("remove"),this.close(),this.Super.prototype.destroy(!0)},a});